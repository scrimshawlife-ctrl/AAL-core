{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "neon_genie.overlay_response.v0",
  "title": "Neon-Genie Overlay Response v0",
  "description": "Standard response envelope from Neon-Genie overlay process via stdout",
  "type": "object",
  "additionalProperties": false,
  "required": ["schema_version", "request_id", "status", "result", "provenance"],
  "properties": {
    "schema_version": {
      "type": "string",
      "const": "neon_genie.overlay_response.v0"
    },
    "request_id": {
      "type": "string",
      "minLength": 8,
      "maxLength": 64,
      "description": "Echo of request_id from request envelope"
    },
    "status": {
      "type": "string",
      "enum": ["success", "error", "not_computable"],
      "description": "Execution status: success, error, or not_computable (missing required inputs)"
    },
    "result": {
      "oneOf": [
        {
          "type": "object",
          "description": "Operation result payload (when status=success)"
        },
        {
          "type": "null",
          "description": "Null when status=error or not_computable"
        }
      ]
    },
    "error": {
      "type": "object",
      "additionalProperties": false,
      "required": ["code", "message"],
      "properties": {
        "code": {
          "type": "string",
          "minLength": 2,
          "maxLength": 32
        },
        "message": {
          "type": "string",
          "minLength": 1,
          "maxLength": 512
        },
        "details": {
          "type": "object"
        }
      },
      "description": "Error details (only present when status=error or not_computable)"
    },
    "provenance": {
      "$ref": "#/$defs/ProvenanceBundle"
    }
  },
  "$defs": {
    "ProvenanceBundle": {
      "type": "object",
      "additionalProperties": false,
      "required": ["engine", "version", "determinism_hash", "execution_time_ms"],
      "properties": {
        "engine": {
          "type": "string",
          "const": "neon_genie",
          "description": "Engine identifier"
        },
        "version": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+\\.\\d+$",
          "description": "Semantic version of the engine"
        },
        "determinism_hash": {
          "type": "string",
          "minLength": 16,
          "maxLength": 128,
          "description": "Hash of execution for determinism validation"
        },
        "execution_time_ms": {
          "type": "number",
          "minimum": 0,
          "description": "Execution time in milliseconds"
        },
        "seed_used": {
          "type": "integer",
          "minimum": 0,
          "description": "SEED value used during execution"
        }
      }
    }
  }
}
