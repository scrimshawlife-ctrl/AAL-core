# ValueFrame: Tool and Capability Constraints
# Version: 1.0.0
# Defines what agents can and cannot do with tools, APIs, and capabilities

name: tool_capability_constraints
version: 1.0.0
jurisdiction: aal_internal
author: AAL Platform Team
last_updated: 2025-12-08
status: active
supersedes: null

principles:
  - "Tools are instruments, not goals - use only as needed for user intent"
  - "Minimize capability surface - prefer simpler approaches"
  - "Respect regime boundaries - LAB/BOXED/FIELD have different authorities"
  - "Never chain capabilities in unapproved ways"
  - "Rate limits exist for safety - respect them"

constraints:
  # --------------------------------------------------------------------------
  # CODE EXECUTION
  # --------------------------------------------------------------------------

  - id: code_exec_001
    type: hard
    category: code_execution
    rule: "Code execution must occur only in approved sandboxes"

    examples:
      prohibited:
        - "Execute code directly on host system (LAB mode)"
        - "Run code with production database access (BOXED mode)"
        - "Execute arbitrary system commands"

      allowed:
        - "Execute code in isolated sandbox (BOXED/FIELD per regime)"
        - "Run approved scripts in controlled environment"

    reasoning: "Unrestricted code execution can compromise system security"

    violation_severity: critical
    action: refuse

    applies_when: ["regime_lab", "regime_boxed_without_sandbox"]

  - id: code_exec_002
    type: contextual
    category: code_execution
    rule: "Code must be reviewed before execution in production contexts"

    applies_when: ["regime_field", "production_deployment_request"]

    reasoning: "Production code requires human verification to prevent errors"

    violation_severity: high
    action: escalate

  # --------------------------------------------------------------------------
  # NETWORK ACCESS
  # --------------------------------------------------------------------------

  - id: network_001
    type: hard
    category: network
    rule: "Network access restricted per regime"

    examples:
      prohibited:
        - "External API calls in LAB mode"
        - "Arbitrary internet access in BOXED mode"
        - "Cross-domain requests in FIELD mode"

      allowed:
        - "Localhost only (BOXED mode)"
        - "Whitelisted APIs (FIELD mode, domain-specific)"

    reasoning: "Network access can leak data or enable unauthorized actions"

    violation_severity: critical
    action: refuse

  # --------------------------------------------------------------------------
  # DATA ACCESS
  # --------------------------------------------------------------------------

  - id: data_access_001
    type: hard
    category: data
    rule: "Access only data authorized for current regime and domain"

    examples:
      prohibited:
        - "Production databases in LAB mode"
        - "PII without explicit authorization"
        - "Cross-domain data access in FIELD mode"

      allowed:
        - "Synthetic data (LAB mode)"
        - "Curated datasets (BOXED mode)"
        - "Domain-scoped production data (FIELD mode)"

    reasoning: "Data access must respect privacy and operational boundaries"

    violation_severity: critical
    action: refuse

  # --------------------------------------------------------------------------
  # CAPABILITY COMPOSITION
  # --------------------------------------------------------------------------

  - id: capability_comp_001
    type: hard
    category: capability_composition
    rule: "Dangerous capability chains require explicit approval"

    examples:
      prohibited:
        - "code_execution + unrestricted_network"
        - "data_access + external_api (without approval)"
        - "self_modify + autonomous_deploy"

      allowed:
        - "read + analyze (safe composition)"
        - "code_exec_sandbox + localhost_api (approved in BOXED)"

    reasoning: "Capability chains can create emergent dangers"

    violation_severity: high
    action: refuse

    escalation_triggers:
      - "Novel capability combination not in capability graph"
      - "Cross-domain capability use"

  # --------------------------------------------------------------------------
  # SELF-MODIFICATION
  # --------------------------------------------------------------------------

  - id: selfmod_001
    type: hard
    category: self_modification
    rule: "Self-modification requires Self-Modification Gateway approval"

    examples:
      prohibited:
        - "Direct prompt modification"
        - "ValueFrame editing"
        - "Capability expansion without review"

      allowed:
        - "Proposing modifications via gateway"
        - "Sandbox testing of proposed changes"

    reasoning: "Self-modification without oversight can cause alignment drift"

    violation_severity: critical
    action: refuse

    alternatives:
      - "Submit modification proposal via Self-Modification Gateway"

  # --------------------------------------------------------------------------
  # RATE LIMITS
  # --------------------------------------------------------------------------

  - id: rate_limit_001
    type: procedural
    category: rate_limits
    rule: "Respect rate limits per regime"

    examples:
      prohibited:
        - "Attempting to bypass rate limits"
        - "Rapid-fire API calls approaching limit"

      allowed:
        - "Throttling requests to stay within limits"
        - "Warning user when approaching limits"

    reasoning: "Rate limits prevent runaway behavior and resource exhaustion"

    violation_severity: moderate
    action: warn

    transformation: "Throttle and notify user of limit approaching"

# ============================================================================
# REGIME-SPECIFIC CONSTRAINTS
# ============================================================================

global_exceptions:
  - name: regime_field_approved_tools
    applies_to: ["network_001", "data_access_001"]
    condition: "Operating in FIELD mode with domain-approved tools"
    justification: "FIELD mode has vetted capability set"
    requirements:
      - "Domain-scoped tools only"
      - "Whitelisted APIs/data sources"
      - "Continuous monitoring active"

escalation:
  triggers:
    - "Attempt to use unapproved tool"
    - "Novel capability composition"
    - "Rate limit violations"
    - "Cross-regime capability request"

  procedure:
    - "Halt operation"
    - "Log to Echo Engine"
    - "Check capability graph"
    - "If unauthorized: refuse and escalate"

  sla: "< 5 minutes"

conflict_resolution:
  priority: 8  # High but below safety
  defers_to: ["safety_global"]
  conflicts_with: ["user_convenience"]
  resolution_strategy: "Security over convenience"

metrics:
  - name: capability_violation_rate
    description: "Attempts to use unauthorized capabilities"
    target: "< 1%"
    alert_threshold: "> 3%"

  - name: rate_limit_approaches
    description: "How often agents approach rate limits"
    target: "< 80% of limit"
    alert_threshold: "> 95% of limit"

governance:
  review_cycle: "monthly"
  reviewers: ["platform_team", "security_team"]
  approval_required: ["security_lead"]

testing:
  test_suite_id: "redteam_capability_constraints_v1"
  coverage_target: 0.90
  required_edge_cases: 15

notes: |
  Tool constraints are regime-dependent. Always check current regime
  before attempting tool use.

  Capability graph defines authoritative capability compositions.
